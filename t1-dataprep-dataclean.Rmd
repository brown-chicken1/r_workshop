---
title: "Data Preparation and Cleaning"
description: |
  A new article created using the Distill format.
output: distill::distill_article
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## 1. Selection of Required Data

* The datasets that are being used for the project include:
  + Topographical data from here: https://www.indonesia-geospasial.com/2020/01/shp-rbi-provinsi-kalimantan-timur.html. Data of Kota Balikpapan, Kota Samarinda, Penajam Paser Utara and Kutai Kartanegara are to be downloaded.
  + The https://www.indonesia-geospasial.com/2020/04/download-shapefile-shp-batas-desa.html comprises the population and demographic data. Data for Kalimantan Timur province was downloaded.
  + https://www.indonesia-geospasial.com/2020/01/download-dem-srtm-30-meter-se-indonesia.html The digital elevation model at 30m     resolution
  + https://www.indonesia-geospasial.com/2020/03/download-data-shapefile-shp-geologi-se.html The geological data.
  + https://www.indonesia-geospasial.com/2020/04/shapefile-shp-titik-api-hotspot.html The forest hot spots.
  + https://download.geofabrik.de/asia/indonesia.html Indonesia OSM Data. Data was downloaded for Indonesia as a whole, and only the road layer was kept.

* After downloading and opening the data, we had to examine individual layers and see what is to be kept.
  + The topographical data layer:
    + Airports: AIRPORTS_LN_50K and AIRPORTS_PT_50k
    + Toponimi (Miscellaneous items): TOPONIMI_PT_50k
    + Different forms of agriculture: AGRIKEBUN_AR_50k, AGRILADANG_AR_50k, AGRISAWAH_AR_50k
    + Different forms of forestry: NONAGRIALANG_AR_50k, NONAGRIHUTANBASAH_AR_50k, NONAGRISEMAKBELUKAR_AR_50k, NONAGRIHUTANKERING_AR_50K
    + Roads: JALAN_LN_50k
    + Settlements: PEMUKIMAN_AR_50k
    + Bus Terminals: TERMINALBUS_PT_50k 
    + Mining Areas: TAMBANG_AR_50k
    + NB: The topographical dataset .zip files comprises these layers for every regency/area (i.e one each for Kutai Kartanegara, one         for Kota Balikpapan etc etc, with the same names) 
  + The demographic layer for Kalimantan Timur:
    + Just 1 layer which is kept.
  
  
* For the topographical map layer, we would have to merge the datasets showing different natural/artificial features to supplement, and clip the layers to within the study area.
  + For each of those layers, we would combine the layers that show the same attribute.
  
* The study area to be used is derived from the population and demographic layer. 
  + Import the shapefile into Qgis by double clicking on it. 
  + We need to select the suitable study area since the layer would contain the regencies, districts and sub-districts for the entire province of East Kalimantan. Right click on the layer, open Attribute Table and first we filter by the "KAB_KOTA" column. Open the "Select Fetures using an Expression" field and enter the following: "KAB_KOTA" = 'KUTAI KARTANEGARA' or "KAB_KOTA" = 'KOTA BALIKPAPAN' or "KAB_KOTA" = 'PENAJAM PASER UTARA' or "KAB_KOTA" = 'KOTA SAMARINDA'. 
  + In the resultant selected layers, we toggle editing on the layer and then copy the selected areas and paste it as a temporary layer by going to Edit > Paste Features As > Temporary Scractch Layer.
  + Repeat the second step, but with the filtering by the specific districts as mentioned in the project brief: 
    + All sub-districts and district of Kota Balipapan, Kota Samarinda
    + Kutai Kartanegara: Anggana, Loa Janan, Loa Kulu, Marang Kayu, Muara Jawa, Samboja, Sanga Sanga, Sebulu Tenaggarong, Tenggarong Seberang and Muara Badak.
    + North Penajam Paser (Penajam Paser Utara) Regency: Babulu, Penajam, Sepaku and Waru.
    + We can manually select the districts and sub-districts by sorting by the "KECAMATAN" column. We select all the districts and sub-districts that do NOT fall into the ones listed above, and then invert the selection using the invert selection tool.
  + Following that, we save the selection into a new GeoPackage layer, by closing the attribute table window, right-clicking on the layer which we made the selection on, and click "Save Selected Features As". If this is the first feature to be included into the GeoPackage file, create a new GeoPackage file, and name the layer "Final Shape".
  + For the following analyses, there are some geometrical errors which we have to be fixed.
    + To fix this, go to the **Processing > Toolbox** on the right and search for Fixed Geometries.
  
    ![](images/1DataPrep1.png){width=40%}
    + Select the newly imported layer and press "OK" in the resultant window.
    
    ![hi](images/1DataPrep2.png){width=40%}
  
    + Save the resultant layer in a GeoPackage format. Click on the newly created temporary layer, go to Export > Save Features As. In the resultant window, select the format **GeoPackage** and then create a new GeoPAckage file. Name the layer "FinalShape_Fixed geometries", leave all other features as intended, before saving.

## Clipping Layers into Study Area

The processing of each layer will differ according to their data type. We have sorted the layers that have been used into the following categories:

**Points**

+ TOPONIMI_PT_50k
+ TERMINALBUS_PT_50k 
+ Forest Fire

**Area**

+ Mining Areas
+ Non-Agricultural Forest Areas
+ Agricultural Areas
+ Settlements

**Mixed**

+ Airport (Both point and area)

**Lines**

+ Roads (gis_osm_roads)


### Processing Polyline (Road Layer)

* Import the layer (gis_osm_roads_a_free.shp).

* There is a need to join incomplete roads. Examine each road segment closely and find out which road segments can be joined, for example roads which go above the bridge. 

  + This will result in the intersection points being overstated when conducting site survey analysis. While it may not be possible to fix every road, most roads where this issue presents itself, are located along the coast or over bridges.
  
* We need to clip the road to the study area. Go to Vector > Geoprocessing Tools > Clip, make sure the newly imported road layer is input as the Input Layer, and the layer to be used as a clip is the FinalShape_Fixed geometries layer (Overlay Layer)that had been prepared.

![hi](images/1DataPrep4.png)

* Save the temporary layer as a GeoPackage layer with the correct CRS as **EPSG:23845 (DGN / Indonesia TM-3 zone 54.1)** and make sure under the "Geometry" tab, the data type is changed to "Line" and the "Include Z values" is not checked.

* Following that, toggle editing on the layer by clicking on the pencil icon. Make sure the selection method is "Select Features" and not other selection methods.

* Select the 2 road segments that are supposed to be joined together.

![hi](images/Picture12.png)

* Click on "Merge Selected Features" in order to merge the 2 line segments together to form a single feature, which we can then extend in order to touch the 2 edges of the line.

![hi](images/Picture13.png)

* Post-merge we have to re-select the merged segment which has become a single feature by clicking on the line segment. Following that we click on the "Reshape Feature".

![hi](images/Picture17.png)

* We click on the edge of one line and then drag it to the start of the other line, this will join the 2 line segments together to form a complete road.

![hi](images/Picture16.png) 

* Repeat this for all segments that have been found to have missing road segments.

* For the site survey analysis, a plot of road intersection density will be used to measure the road density in a particular area.

* 

